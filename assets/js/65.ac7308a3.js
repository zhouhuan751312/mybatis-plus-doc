(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{206:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"å¤šç§Ÿæˆ·-sql-è§£æå™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¤šç§Ÿæˆ·-sql-è§£æå™¨","aria-hidden":"true"}},[t._v("#")]),t._v(" å¤šç§Ÿæˆ· SQL è§£æå™¨")]),t._v(" "),a("ul",[a("li",[t._v("è¿™é‡Œé…åˆ åˆ†é¡µæ‹¦æˆªå™¨ ä½¿ç”¨ï¼Œ spring boot ä¾‹å­é…ç½®å¦‚ä¸‹ï¼š")])]),t._v(" "),a("p",[t._v("ç¤ºä¾‹å·¥ç¨‹ï¼š")]),t._v(" "),a("p",[t._v("ğŸ‘‰ "),a("a",{attrs:{href:"https://gitee.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-tenant",target:"_blank",rel:"noopener noreferrer"}},[t._v("mybatis-plus-sample-tenant"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("ğŸ‘‰ "),a("a",{attrs:{href:"https://git.oschina.net/baomidou/mybatisplus-spring-boot",target:"_blank",rel:"noopener noreferrer"}},[t._v("mybatisplus-spring-boot"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" PaginationInterceptor "),a("span",{attrs:{class:"token function"}},[t._v("paginationInterceptor")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    PaginationInterceptor paginationInterceptor "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("PaginationInterceptor")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*\n     * ã€æµ‹è¯•å¤šç§Ÿæˆ·ã€‘ SQL è§£æå¤„ç†æ‹¦æˆªå™¨<br>\n     * è¿™é‡Œå›ºå®šå†™æˆä½æˆ· 1 å®é™…æƒ…å†µä½ å¯ä»¥ä»cookieè¯»å–ï¼Œå› æ­¤æ•°æ®çœ‹ä¸åˆ° ã€ éº»èŠ±è—¤ ã€‘ è¿™æ¡è®°å½•ï¼ˆ æ³¨æ„è§‚å¯Ÿ SQL ï¼‰<br>\n     */")]),t._v("\n    List"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ISqlParser"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" sqlParserList "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TenantSqlParser tenantSqlParser "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("TenantSqlParser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    tenantSqlParser"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setTenantHandler")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("TenantHandler")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" Expression "),a("span",{attrs:{class:"token function"}},[t._v("getTenantId")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" where"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("// è¯¥ where æ¡ä»¶ 3.2.0 ç‰ˆæœ¬å¼€å§‹æ·»åŠ çš„ï¼Œç”¨äºåˆ†åŒºæ˜¯å¦ä¸ºåœ¨ where æ¡ä»¶ä¸­ä½¿ç”¨")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("// æ­¤åˆ¤æ–­ç”¨äºæ”¯æŒè¿”å›å¤šä¸ªç§Ÿæˆ· ID åœºæ™¯ï¼Œå…·ä½“ä½¿ç”¨æŸ¥çœ‹ç¤ºä¾‹å·¥ç¨‹")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("LongValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("L"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),a("span",{attrs:{class:"token function"}},[t._v("getTenantIdColumn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"tenant_id"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("doTableFilter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String tableName"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("// è¿™é‡Œå¯ä»¥åˆ¤æ–­æ˜¯å¦è¿‡æ»¤è¡¨")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v('/*\n            if ("user".equals(tableName)) {\n                return true;\n            }*/')]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sqlParserList"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tenantSqlParser"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    paginationInterceptor"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setSqlParserList")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sqlParserList"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    paginationInterceptor"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setSqlParserFilter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ISqlParserFilter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("doFilter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MetaObject metaObject"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            MappedStatement ms "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" SqlParserHelper"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getMappedStatement")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("metaObject"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("// è¿‡æ»¤è‡ªå®šä¹‰æŸ¥è¯¢æ­¤æ—¶æ— ç§Ÿæˆ·ä¿¡æ¯çº¦æŸã€ éº»èŠ±è—¤ ã€‘å‡ºç°")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"com.baomidou.springboot.mapper.UserMapper.selectListBySQL"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("equals")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getId")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" paginationInterceptor"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("ç›¸å…³ SQL è§£æå¦‚å¤šç§Ÿæˆ·å¯é€šè¿‡ "),a("code",[t._v("@SqlParser(filter=true)")]),t._v(" æ’é™¤ SQL è§£æï¼Œ"),a("s",[t._v("æ³¨æ„ï¼ï¼å…¨å±€é…ç½® sqlParserCache è®¾ç½®ä¸º true æ‰ç”Ÿæ•ˆã€‚")]),t._v("(3.1.1å¼€å§‹ä¸å†éœ€è¦è¿™ä¸€æ­¥)")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# å¼€å¯ SQL è§£æç¼“å­˜æ³¨è§£ç”Ÿæ•ˆ")]),t._v("\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("mybatis-plus")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("global-config")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("sql-parser-cache")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])])])},[],!1,null,null,null);e.options.__file="tenant.md";s.default=e.exports}}]);